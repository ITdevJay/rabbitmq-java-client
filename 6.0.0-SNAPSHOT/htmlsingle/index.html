<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>RabbitMQ AMQP 0.9.1 Java Client</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>RabbitMQ AMQP 0.9.1 Java Client</h1>
<div class="details">
<span id="revnumber">version 6.0.0-SNAPSHOT</span>
<br><span id="revremark">(70e0efa)</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#support-timeline">Support Timeline</a></li>
<li><a href="#jdk-versions">JDK and Android Version Support</a></li>
<li><a href="#license">License</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#dependencies">Dependencies</a>
<ul class="sectlevel2">
<li><a href="#maven">Maven</a></li>
<li><a href="#gradle">Gradle</a></li>
<li><a href="#snapshots">Snapshots</a></li>
</ul>
</li>
<li><a href="#overview">API Overview</a></li>
<li><a href="#imports">Imports</a></li>
<li><a href="#connections-and-channels">Connections and Channels</a></li>
<li><a href="#connecting">Connecting to RabbitMQ</a>
<ul class="sectlevel2">
<li><a href="#uri">Connecting Using a URI</a></li>
<li><a href="#endpoints-list">Using Lists of Endpoints</a></li>
</ul>
</li>
<li><a href="#disconnecting">Disconnecting from RabbitMQ</a></li>
<li><a href="#connection-and-channel-lifespan">Connection and Channel Lifespan</a></li>
<li><a href="#client-provided-names">Client-Provided Connection Name</a></li>
<li><a href="#exchanges-and-queues">Using Exchanges and Queues</a>
<ul class="sectlevel2">
<li><a href="#passive-declaration">Passive Declaration</a></li>
<li><a href="#nowait-methods">Operations with Optional Responses</a></li>
<li><a href="#deleting-entities">Deleting Entities and Purging Messages</a></li>
</ul>
</li>
<li><a href="#publishing">Publishing Messages</a></li>
<li><a href="#concurrency">Channels and Concurrency Considerations (Thread Safety)</a></li>
<li><a href="#consuming">Receiving Messages by Subscription ("Push API")</a></li>
<li><a href="#getting">Retrieving Individual Messages ("Pull API")</a></li>
<li><a href="#returning">Handling unroutable messages</a></li>
<li><a href="#shutdown">Shutdown Protocol</a>
<ul class="sectlevel2">
<li><a href="#shutdown-overview">Overview of the Client Shutdown Process</a></li>
<li><a href="#shutdown-cause">Information about the circumstances of a shutdown</a></li>
<li><a href="#shutdown-atomicity">Atomicity and use of the <code>isOpen()</code> method</a></li>
</ul>
</li>
<li><a href="#advanced-connection">Advanced Connection Options</a>
<ul class="sectlevel2">
<li><a href="#consumer-thread-pool">Consumer Operation Thread Pool</a></li>
<li><a href="#service-discovery-with-address-resolver">Service discovery with the AddressResolver interface</a></li>
<li><a href="#heartbeats-timeout">Heartbeat Timeout</a></li>
<li><a href="#thread-factories">Custom Thread Factories</a></li>
<li><a href="#java-nio">Support for Java non-blocking IO</a></li>
</ul>
</li>
<li><a href="#recovery">Automatic Recovery From Network Failures</a>
<ul class="sectlevel2">
<li><a href="#connection-recovery">Connection Recovery</a></li>
<li><a href="#recovery-triggers">When Will Connection Recovery Be Triggered?</a></li>
<li><a href="#recovery-listeners">Recovery Listeners</a></li>
<li><a href="#publishers">Effects on Publishing</a></li>
<li><a href="#topology-recovery">Topology Recovery</a></li>
<li><a href="#automatic-recovery-limitations">Failure Detection and Recovery Limitations</a></li>
<li><a href="#recovery-and-acknowledgements">Manual Acknowledgements and Automatic Recovery</a></li>
<li><a href="#recovery-channel-lifecycle">Channels Lifecycle and Topology Recovery</a></li>
<li><a href="#cache-pitfalls">Caveats and Limitations</a></li>
</ul>
</li>
<li><a href="#unhandled-exceptions">Unhandled Exceptions</a></li>
<li><a href="#metrics">Metrics and Monitoring</a>
<ul class="sectlevel2">
<li><a href="#metrics-micrometer">Micrometer support</a></li>
<li><a href="#metrics-dropwizard-metrics">Dropwizard Metrics support</a></li>
</ul>
</li>
<li><a href="#gae-pitfalls">RabbitMQ Java Client on Google App Engine</a></li>
<li><a href="#rpc">The RPC (Request/Reply) Pattern: an Example</a></li>
<li><a href="#tls">TLS Support</a></li>
<li><a href="#oauth2-support">OAuth 2 Support</a>
<ul class="sectlevel2">
<li><a href="#oauth2-getting-token">Getting the OAuth 2 Token</a></li>
<li><a href="#oauth2-refreshing-token">Refreshing the Token</a></li>
</ul>
</li>
<li><a href="#micrometer-observation">Appendix A: Micrometer Observation</a>
<ul class="sectlevel2">
<li><a href="#observability-conventions">Observability - Conventions</a></li>
<li><a href="#observability-spans">Observability - Spans</a>
<ul class="sectlevel3">
<li><a href="#observability-spans-process-observation">Process Observation Span</a></li>
<li><a href="#observability-spans-publish-observation">Publish Observation Span</a></li>
<li><a href="#observability-spans-receive-observation">Receive Observation Span</a></li>
</ul>
</li>
<li><a href="#observability-metrics">Observability - Metrics</a>
<ul class="sectlevel3">
<li><a href="#observability-metrics-process-observation">Process Observation</a></li>
<li><a href="#observability-metrics-publish-observation">Publish Observation</a></li>
<li><a href="#observability-metrics-receive-observation">Receive Observation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The RabbitMQ Java client library allows Java and JVM-based applications to connect to and interact with RabbitMQ nodes using AMQP 0.9.1.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="support-timeline"><a class="anchor" href="#support-timeline"></a>Support Timeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Please see the <a href="https://rabbitmq.com/java-versions.html">RabbitMQ Java libraries support page</a> for the support timeline.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jdk-versions"><a class="anchor" href="#jdk-versions"></a>JDK and Android Version Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>5.x release series of this library <a href="https://rabbitmq.com/java-versions.html">require JDK 8</a>, both for compilation and at runtime.
On Android, this means only <a href="https://developer.android.com/guide/platform/j8-jack.html">Android 7.0 or later</a> versions are supported.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="license"><a class="anchor" href="#license"></a>License</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The library is open source, developed <a href="https://github.com/rabbitmq/rabbitmq-java-client/">on GitHub</a>, and is triple-licensed under</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache Public License 2.0</a></p>
</li>
<li>
<p><a href="https://www.mozilla.org/MPL/2.0/">Mozilla Public License 2.0</a></p>
</li>
<li>
<p><a href="http://www.gnu.org/licenses/gpl-2.0.html">GPL 2.0</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This means that the user can consider the library to be licensed under <strong>any of the licenses from the list above</strong>.
For example, the user may choose the Apache Public License 2.0 and include this client into
a commercial product.
Codebases that are licensed under the GPLv2 may choose GPLv2, and so on.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RabbitMQ Java client connects to RabbitMQ server nodes.</p>
</div>
<div class="paragraph">
<p>You will need a running <a href="https://rabbitmq.com/download.html">RabbitMQ node</a> to use with the client library.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dependencies"><a class="anchor" href="#dependencies"></a>Dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use your favorite build management tool to add the client dependencies to your project.</p>
</div>
<div class="sect2">
<h3 id="maven"><a class="anchor" href="#maven"></a>Maven</h3>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>

  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>com.rabbitmq<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>amqp-client<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>6.0.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>

<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Snapshots require to declare the <a href="#snapshots">appropriate repository</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="gradle"><a class="anchor" href="#gradle"></a>Gradle</h3>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
  compile <span class="string"><span class="delimiter">&quot;</span><span class="content">com.rabbitmq:amqp-client:6.0.0-SNAPSHOT</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Snapshots require to declare the <a href="#snapshots">appropriate repository</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="snapshots"><a class="anchor" href="#snapshots"></a>Snapshots</h3>
<div class="paragraph">
<p>Releases are available from Maven Central, which does not require specific declaration.
Snapshots are available from a repository which must be declared in the dependency management configuration.</p>
</div>
<div class="paragraph">
<p>With Maven:</p>
</div>
<div class="listingblock">
<div class="title">Snapshot repository declaration for Maven</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;repositories&gt;</span>

  <span class="tag">&lt;repository&gt;</span>
    <span class="tag">&lt;id&gt;</span>ossrh<span class="tag">&lt;/id&gt;</span>
    <span class="tag">&lt;url&gt;</span>https://oss.sonatype.org/content/repositories/snapshots<span class="tag">&lt;/url&gt;</span>
    <span class="tag">&lt;snapshots&gt;</span><span class="tag">&lt;enabled&gt;</span>true<span class="tag">&lt;/enabled&gt;</span><span class="tag">&lt;/snapshots&gt;</span>
    <span class="tag">&lt;releases&gt;</span><span class="tag">&lt;enabled&gt;</span>false<span class="tag">&lt;/enabled&gt;</span><span class="tag">&lt;/releases&gt;</span>
  <span class="tag">&lt;/repository&gt;</span>

<span class="tag">&lt;/repositories&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With Gradle:</p>
</div>
<div class="listingblock">
<div class="title">Snapshot repository declaration for Gradle:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
  maven { url <span class="string"><span class="delimiter">'</span><span class="content">https://oss.sonatype.org/content/repositories/snapshots</span><span class="delimiter">'</span></span> }
  mavenCentral()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>API Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers <a href="https://github.com/rabbitmq/rabbitmq-java-client/">RabbitMQ Java client</a> and its public API.
It assumes that the reader is familiar with <a href="https://rabbitmq.com/getstarted.html" target="_blank" rel="noopener">the basics <span class="icon"><i class="fa fa-external-link"></i></span></a>.</p>
</div>
<div class="paragraph">
<p>The client API exposes key entities in the <a href="https://rabbitmq.com/tutorials/amqp-concepts.html">AMQP 0-9-1 protocol model</a>, with additional abstractions for ease of use.</p>
</div>
<div class="paragraph">
<p>RabbitMQ Java client uses <code>com.rabbitmq.client</code> as its top-level package.
The key classes and interfaces are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Channel</code>: represents an AMQP 0-9-1 channel, and provides most of the operations (protocol methods).</p>
</li>
<li>
<p><code>Connection</code>: represents an AMQP 0-9-1 connection.</p>
</li>
<li>
<p><code>ConnectionFactory</code>: constructs <code>Connection</code> instances.</p>
</li>
<li>
<p><code>Consumer</code>: represents a message consumer.</p>
</li>
<li>
<p><code>DefaultConsumer</code>: commonly used base class for consumers.</p>
</li>
<li>
<p><code>BasicProperties</code>: message properties (metadata).</p>
</li>
<li>
<p><code>BasicProperties.Builder</code>: builder for <code>BasicProperties</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Protocol operations are available through the <code>Channel</code> interface.
<code>Connection</code> is used to open channels, register connection lifecycle event handlers, and close connections that are no longer needed.
<code>Connection`s are instantiated through `ConnectionFactory</code>, which is how you configure various connection settings, such as the vhost or username.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="imports"><a class="anchor" href="#imports"></a>Imports</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The interfaces and classes of the AMQP Java client are located in the <code>com.rabbitmq.client</code> package.
You can import the types one by one or use a wildcard import:</p>
</div>
<div class="listingblock">
<div class="title">Core API imports</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.rabbitmq.client</span>.*;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="connections-and-channels"><a class="anchor" href="#connections-and-channels"></a>Connections and Channels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The core API classes are <code>Connection</code> and <code>Channel</code>, representing an AMQP 0-9-1 connection and  channel, respectively.
The next sections show how to use them.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="connecting"><a class="anchor" href="#connecting"></a>Connecting to RabbitMQ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following code connects to a RabbitMQ node using the given parameters (host name, port number, etc):</p>
</div>
<div class="listingblock">
<div class="title">Connection to a RabbitMQ node</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();
factory.setUsername(username);  <i class="conum" data-value="1"></i><b>(1)</b>
factory.setPassword(password);  <i class="conum" data-value="1"></i><b>(1)</b>
factory.setVirtualHost(virtualHost);
factory.setHost(hostName);
factory.setPort(portNumber);

<span class="predefined-type">Connection</span> conn = factory.newConnection();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>guest</code>/<code>guest</code> by default, limited to localhost connections</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All of these parameters have sensible defaults for a RabbitMQ node running locally.</p>
</div>
<div class="paragraph">
<p>The default value for a property will be used if the property remains unassigned prior to creating a connection:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>guest</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>guest</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hostname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localhost</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5672 for regular connections, 5671 for <a href="https://rabbitmq.com/ssl.html">connections that use TLS</a></p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="uri"><a class="anchor" href="#uri"></a>Connecting Using a URI</h3>
<div class="paragraph">
<p>Alternatively, <a href="https://rabbitmq.com/uri-spec.html">URIs</a> may be used:</p>
</div>
<div class="listingblock">
<div class="title">Connection with a URI</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();
factory.setUri(<span class="string"><span class="delimiter">&quot;</span><span class="content">amqp://username:password@host:port/virtualHost</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Connection</span> conn = factory.newConnection();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Successful and unsuccessful client connection events can be <a href="https://rabbitmq.com/logging.html">observed in server node logs</a>.</p>
</div>
<div class="paragraph">
<p>Note that <a href="https://rabbitmq.com/access-control.html">user guest can only connect from localhost</a> by default.
This is to limit well-known credential use in production systems.</p>
</div>
<div class="paragraph">
<p>Application developers can <a href="#client-provided-names">assign a custom name to a connection</a>.
If set,  the name will be mentioned in RabbitMQ node logs as well as <a href="https://rabbitmq.com/management.html">management UI</a>.</p>
</div>
<div class="paragraph">
<p>The <code>Connection</code> interface can then be used to open a channel:</p>
</div>
<div class="listingblock">
<div class="title">Opening a channel</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Channel</span> channel = conn.createChannel();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The channel can now be used to send and receive messages, as described in subsequent sections.</p>
</div>
</div>
<div class="sect2">
<h3 id="endpoints-list"><a class="anchor" href="#endpoints-list"></a>Using Lists of Endpoints</h3>
<div class="paragraph">
<p>It is possible to specify a list of endpoints to use when connecting.
The first reachable endpoint will be used.
In case of <a href="#recovery">connection failures</a>, using a list of endpoints makes it possible for the application to connect to a different node if the original one is down.</p>
</div>
<div class="paragraph">
<p>To use multiple endpoints, provide a list of <code>Address</code>es to <code>ConnectionFactory#newConnection</code>.
An <code>Address</code> represents a hostname and port pair.</p>
</div>
<div class="listingblock">
<div class="title">Using multiple endpoints</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Address<span class="type">[]</span> addrArr = <span class="keyword">new</span> Address<span class="type">[]</span> {
    <span class="keyword">new</span> Address(hostname1, port1),
    <span class="keyword">new</span> Address(hostname2, port2)
};
<span class="predefined-type">Connection</span> conn = factory.newConnection(addrArr);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code snippet above, the library will attempt to connect to <code>hostname1:port1</code>, and if that fails to <code>hostname2:port2</code>.
The connection returned is the first in the array that succeeds (without throwing
<code>IOException</code>).
This is entirely equivalent to repeatedly setting host and port on a factory, calling <code>factory.newConnection()</code> each time, until one of them succeeds.</p>
</div>
<div class="paragraph">
<p>If an <code>ExecutorService</code> is provided as well (using the form <code>factory.newConnection(es, addrArr)</code>) the thread pool is associated with the (first) successful connection.</p>
</div>
<div class="paragraph">
<p>If you want more control over the host to connect to, see
<a href="#service-discovery-with-address-resolver">the support for service discovery</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="disconnecting"><a class="anchor" href="#disconnecting"></a>Disconnecting from RabbitMQ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To disconnect, simply close the channel and the connection:</p>
</div>
<div class="listingblock">
<div class="title">Closing a channel and a connection</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">channel.close();
conn.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that closing the channel may be considered good practice, but is not strictly necessary here - it will be done automatically anyway when the underlying connection is closed.</p>
</div>
<div class="paragraph">
<p>Client disconnection events can be <a href="https://rabbitmq.com/networking.html#logging">observed in server node logs</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="connection-and-channel-lifespan"><a class="anchor" href="#connection-and-channel-lifespan"></a>Connection and Channel Lifespan</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Client <a href="https://rabbitmq.com/connections.html">connections</a> are meant to be long-lived.
The underlying protocol is designed and optimized for long-running connections.
That means that opening a new connection per operation, e.g. a message published, is unnecessary and strongly discouraged as it will introduce a lot of network roundtrips and overhead.</p>
</div>
<div class="paragraph">
<p><a href="https://rabbitmq.com/channels.html">Channels</a> are also meant to be long-lived but since many recoverable protocol errors will result in channel closure, channel lifespan could be shorter than that of its connection.
Closing and opening new channels per operation is usually unnecessary but can be appropriate.
When in doubt, consider reusing channels first.</p>
</div>
<div class="paragraph">
<p><a href="https://rabbitmq.com/channels.html#error-handling">Channel-level exceptions</a> such as attempts to consume from a queue that does not exist will result in channel closure.
A closed channel can no longer be used and will not receive any more events from the server (such as message deliveries).
Channel-level exceptions will be logged by RabbitMQ and will initiate a shutdown sequence for the channel (see below).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="client-provided-names"><a class="anchor" href="#client-provided-names"></a>Client-Provided Connection Name</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RabbitMQ nodes have a limited amount of information about their clients:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>their TCP endpoint (source IP address and port)</p>
</li>
<li>
<p>the credentials used</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This information alone can make identifying applications and instances problematic, in particular when credentials can be shared and clients connect over a load balancer but <a href="https://rabbitmq.com/networking.html#proxy-protocol">Proxy protocol</a> cannot be enabled.</p>
</div>
<div class="paragraph">
<p>To make it easier to identify clients in <a href="https://rabbitmq.com/logging.html">server logs</a> and <a href="https://rabbitmq.com/management.html">management UI</a>, AMQP 0-9-1 client connections, including the RabbitMQ Java client, can provide a custom identifier.
If set, the identifier will be mentioned in log entries and management UI.
The identifier is known as the <strong>client-provided connection name</strong>.
The name can be used to identify an application or a specific component within an application.
The name is optional; however, developers are strongly encouraged to provide one as it would significantly simplify certain operational tasks.</p>
</div>
<div class="paragraph">
<p>RabbitMQ Java client&#8217;s <a href="https://rabbitmq.github.io/rabbitmq-java-client/api/current/com/rabbitmq/client/ConnectionFactory.html#newConnection(java.util.concurrent.ExecutorService,com.rabbitmq.client.Address%5B%5D,java.lang.String)"><code>ConnectionFactory#newConnection</code> method overrides</a> accept a client-provided connection name.
Here&#8217;s a modified connection example used above which provides such a name:</p>
</div>
<div class="listingblock">
<div class="title">Set a connection name</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();
factory.setUri(<span class="string"><span class="delimiter">&quot;</span><span class="content">amqp://user:password@host:port/vhost</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Connection</span> conn = factory.newConnection(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">app:audit component:event-consumer</span><span class="delimiter">&quot;</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Provide a custom connection name</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exchanges-and-queues"><a class="anchor" href="#exchanges-and-queues"></a>Using Exchanges and Queues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Client applications work with exchanges and <a href="https://rabbitmq.com/queues.html">queues</a>, the high-level <a href="https://rabbitmq.com/tutorials/amqp-concepts.html">building blocks of the protocol</a>.
These must be declared before they can be used.
Declaring either type of object simply ensures that one of that name exists, creating it if necessary.</p>
</div>
<div class="paragraph">
<p>Continuing the previous example, the following code declares an exchange and a <a href="https://rabbitmq.com/queues.html#server-named-queues">server-named queue</a>, then binds them together.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">channel.exchangeDeclare(exchangeName, <span class="string"><span class="delimiter">&quot;</span><span class="content">direct</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>);
<span class="predefined-type">String</span> queueName = channel.queueDeclare().getQueue();
channel.queueBind(queueName, exchangeName, routingKey);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will actively declare the following objects, both of which can be customised by using additional parameters.
Here neither of them have any special arguments.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a durable, non-autodelete exchange of "direct" type</p>
</li>
<li>
<p>a non-durable, exclusive, autodelete queue with a generated name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The above function calls then bind the queue to the exchange with the
given routing key.</p>
</div>
<div class="paragraph">
<p>Note that this would be a typical way to declare a queue when only one client wants to work with it: it doesn&#8217;t need a well-known name, no other client can use it (exclusive) and will be cleaned up automatically (autodelete).
If several clients want to share a queue with a well-known name, this code would be appropriate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">channel.exchangeDeclare(exchangeName, <span class="string"><span class="delimiter">&quot;</span><span class="content">direct</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>);
channel.queueDeclare(queueName, <span class="predefined-constant">true</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">null</span>);
channel.queueBind(queueName, exchangeName, routingKey);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will actively declare:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a durable, non-autodelete exchange of "direct" type</p>
</li>
<li>
<p>a durable, non-exclusive, non-autodelete queue with a well-known name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Many <code>Channel</code> API methods are overloaded.
These convenient short forms of <code>exchangeDeclare</code>, <code>queueDeclare</code> and <code>queueBind</code> use sensible defaults.
There are also longer forms with more parameters, to let you override these defaults as necessary, giving full control where needed.</p>
</div>
<div class="paragraph">
<p>This "short form, long form" pattern is used throughout the client API uses.</p>
</div>
<div class="sect2">
<h3 id="passive-declaration"><a class="anchor" href="#passive-declaration"></a>Passive Declaration</h3>
<div class="paragraph">
<p>Queues and exchanges can be declared "passively".
A passive declare simply checks that the entity with the provided name exists.
If it does, the operation is a no-op.
For queues successful passive declares will return the same information as non-passive ones, namely the number of consumers and messages in <a href="https://rabbitmq.com/confirms.html">ready state</a> in the queue.</p>
</div>
<div class="paragraph">
<p>If the entity does not exist, the operation fails with a channel level exception.
The channel cannot be used after that.
A new channel should be opened.
It is common to use one-off (temporary) channels for passive declarations.</p>
</div>
<div class="paragraph">
<p><code>Channel#queueDeclarePassive</code> and <code>Channel#exchangeDeclarePassive</code> are the methods used for passive declaration.
The following example demonstrates <code>Channel#queueDeclarePassive</code>:</p>
</div>
<div class="listingblock">
<div class="title">Passive declaration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AMQP.Queue.DeclareOk response = channel.queueDeclarePassive(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">queue-name</span><span class="delimiter">&quot;</span></span>
);
response.getMessageCount();  <i class="conum" data-value="1"></i><b>(1)</b>
response.getConsumerCount();  <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Return the number of messages in Ready state in the queue</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Return the number of consumers the queue has</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Channel#exchangeDeclarePassive</code>'s return value contains no useful information.
Therefore if the method returns and no channel exceptions occurs, it means that the exchange does exist.</p>
</div>
</div>
<div class="sect2">
<h3 id="nowait-methods"><a class="anchor" href="#nowait-methods"></a>Operations with Optional Responses</h3>
<div class="paragraph">
<p>Some common operations also have a "no wait" version which won&#8217;t wait for server response.
For example, to declare a queue and instruct the server to not send any response, use:</p>
</div>
<div class="listingblock">
<div class="title">Queue declaration with "no wait"</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">channel.queueDeclareNoWait(queueName, <span class="predefined-constant">true</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">null</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The "no wait" versions are more efficient but offer lower safety guarantees, e.g. they are more dependent on the <a href="https://rabbitmq.com/heartbeats.html">heartbeat mechanism</a> for detection of failed operations.
When in doubt, start with the standard version.
The "no wait" versions are only needed in scenarios with high topology (queue, binding) churn.</p>
</div>
</div>
<div class="sect2">
<h3 id="deleting-entities"><a class="anchor" href="#deleting-entities"></a>Deleting Entities and Purging Messages</h3>
<div class="paragraph">
<p>A queue or exchange can be explicitly deleted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">channel.queueDelete(<span class="string"><span class="delimiter">&quot;</span><span class="content">queue-name</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to delete a queue only if it is empty:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">channel.queueDelete(<span class="string"><span class="delimiter">&quot;</span><span class="content">queue-name</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or if it is not used (does not have any consumers):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">channel.queueDelete(<span class="string"><span class="delimiter">&quot;</span><span class="content">queue-name</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>, <span class="predefined-constant">false</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A queue can be purged (all of its messages deleted):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">channel.queuePurge(<span class="string"><span class="delimiter">&quot;</span><span class="content">queue-name</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="publishing"><a class="anchor" href="#publishing"></a>Publishing Messages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To publish a message to an exchange, use <code>Channel.basicPublish</code> as follows:</p>
</div>
<div class="listingblock">
<div class="title">Publishing a message to an exchange</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">byte</span><span class="type">[]</span> messageBodyBytes = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, world!</span><span class="delimiter">&quot;</span></span>.getBytes();
channel.basicPublish(exchangeName, routingKey, <span class="predefined-constant">null</span>, messageBodyBytes);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For fine control, use overloaded variants to specify the <code>mandatory</code> flag, or send messages with pre-set message properties (see the <a href="https://rabbitmq.com/publishers.html">Publishers guide</a> for details):</p>
</div>
<div class="listingblock">
<div class="title">Publishing a message with the mandatory flag and pre-set properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">channel.basicPublish(exchangeName, routingKey, mandatory,
                     MessageProperties.PERSISTENT_TEXT_PLAIN,
                     messageBodyBytes);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sends a message with delivery mode 2 (persistent), priority 1 and content-type "text/plain".</p>
</div>
<div class="paragraph">
<p>Use the <code>Builder</code> class to build a message properties object with as many properties as needed, for example:</p>
</div>
<div class="listingblock">
<div class="title">Using the property builder</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">channel.basicPublish(
    exchangeName,
    routingKey,
    <span class="keyword">new</span> AMQP.BasicProperties.Builder()
        .contentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>)
        .deliveryMode(<span class="integer">2</span>)
        .priority(<span class="integer">1</span>)
        .userId(<span class="string"><span class="delimiter">&quot;</span><span class="content">bob</span><span class="delimiter">&quot;</span></span>)
        .build(),
    messageBodyBytes);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example publishes a message with custom headers:</p>
</div>
<div class="listingblock">
<div class="title">Setting custom headers</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; headers = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
headers.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">latitude</span><span class="delimiter">&quot;</span></span>,  <span class="float">51.5252949</span>);
headers.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">longitude</span><span class="delimiter">&quot;</span></span>, -<span class="float">0.0905493</span>);

channel.basicPublish(
    exchangeName,
    routingKey,
    <span class="keyword">new</span> AMQP.BasicProperties.Builder().headers(headers).build(),
    messageBodyBytes);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example publishes a message with expiration:</p>
</div>
<div class="listingblock">
<div class="title">Setting expiration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">channel.basicPublish(
    exchangeName,
    routingKey,
    <span class="keyword">new</span> AMQP.BasicProperties.Builder().expiration(<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span>).build(),
    messageBodyBytes);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is just a brief set of examples that does not demonstrate every supported property.</p>
</div>
<div class="paragraph">
<p>Note that <code>BasicProperties</code> is an inner class of an outer class, <code>AMQP</code>.</p>
</div>
<div class="paragraph">
<p>Invocations of <code>Channel#basicPublish</code> will eventually block if a <a href="https://www.rabbitmq.com/alarms.html">resource-driven alarm</a> is in effect.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="concurrency"><a class="anchor" href="#concurrency"></a>Channels and Concurrency Considerations (Thread Safety)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sharing <code>Channel</code> instances between threads should be avoided.
Applications should be using a <code>Channel</code> per thread instead of sharing the same <code>Channel</code> across multiple threads.</p>
</div>
<div class="paragraph">
<p>While some operations on channels are safe to invoke concurrently, some are not and will result in incorrect frame interleaving on the wire, double acknowledgements and so on.</p>
</div>
<div class="paragraph">
<p>Concurrent publishing on a shared channel can result in incorrect frame interleaving on the wire, triggering a connection-level protocol exception and immediate connection closure by the broker.
It therefore requires explicit synchronization in application code (<code>Channel#basicPublish</code> must be invoked in a critical section).
Sharing channels between threads will also interfere with https//rabbitmq.com/confirms.html[Publisher
Confirms].
Concurrent publishing on a shared channel is best avoided entirely, e.g. by using a channel per thread.</p>
</div>
<div class="paragraph">
<p>It is possible to use channel pooling to avoid concurrent publishing on a shared channel: once a thread is done working with a channel, it returns it to the pool, making the channel available for another thread.
Channel pooling can be thought of as a specific synchronization solution.
It is recommended that an existing pooling library is used instead of a homegrown solution.
For example, <a href="https://projects.spring.io/spring-amqp/">Spring AMQP</a> which comes with a ready-to-use channel pooling feature.</p>
</div>
<div class="paragraph">
<p>Channels consume resources and in most cases applications very rarely need more than a few hundreds open channels in the same JVM process.
If we assume that the application has a thread for each channel (as channel shouldn&#8217;t be used concurrently), thousands of threads for a single JVM is already a fair amount of overhead that likely can be avoided.
Moreover a few fast publishers can easily saturate a network interface and a broker node: publishing involves less work than routing, storing and delivering messages.</p>
</div>
<div class="paragraph">
<p>A classic anti-pattern to be avoided is opening a channel for each published message.
Channels are supposed to be reasonably long-lived and opening a new one is a network round-trip which makes this pattern extremely inefficient.</p>
</div>
<div class="paragraph">
<p>Consuming in one thread and publishing in another thread on a shared channel can be safe.</p>
</div>
<div class="paragraph">
<p>Server-pushed deliveries (see the section below) are dispatched concurrently with a guarantee that per-channel ordering is preserved.
The dispatch mechanism uses a <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ExecutorService.html"><code>java.util.concurrent.ExecutorService</code></a>, one per connection.
It is possible to provide a custom executor that will be shared by all connections produced by a single <code>ConnectionFactory</code> using the <code>ConnectionFactory#setSharedExecutor</code> setter.</p>
</div>
<div class="paragraph">
<p>When <a href="https://rabbitmq.com/confirms.html">manual acknowledgements</a> are used, it is important to consider what thread does the acknowledgement.
If it&#8217;s different from the thread that received the delivery (e.g. <code>Consumer#handleDelivery</code> delegated delivery handling to a different thread), acknowledging with the <code>multiple</code> parameter set to <code>true</code> is unsafe and will result in double-acknowledgements, and therefore a channel-level protocol exception that closes the channel.
Acknowledging a single message at a time can be safe.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="consuming"><a class="anchor" href="#consuming"></a>Receiving Messages by Subscription ("Push API")</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The most efficient way to receive messages is to set up a subscription using the <code>Consumer</code> interface.
The messages will then be delivered automatically as they arrive, rather than having to be explicitly requested.</p>
</div>
<div class="paragraph">
<p>When calling the API methods relating to <code>Consumer</code>s, individual subscriptions are always referred to by their consumer tags.
A consumer tag is a consumer identifier which can be either client- or server-generated.
To let RabbitMQ generate a node-wide unique tag, use a <code>Channel#basicConsume</code> override that doesn&#8217;t take a consumer tag argument or pass an empty string for consumer tag and use the value returned by <code>Channel#basicConsume</code>.
Consumer tags are used to cancel consumers.</p>
</div>
<div class="paragraph">
<p>Distinct <code>Consumer</code> instances must have distinct consumer tags.
Duplicate consumer tags on a connection is strongly discouraged and can lead to issues with <a href="#connection-recovery">automatic connection recovery</a> and confusing monitoring data when consumers are monitored.</p>
</div>
<div class="paragraph">
<p>The easiest way to implement a <code>Consumer</code> is to subclass the convenience class <code>DefaultConsumer</code>.
An object of this subclass can be passed on a <code>basicConsume</code> call to set up the subscription:</p>
</div>
<div class="listingblock">
<div class="title">Using the <code>DefaultConsumer</code> convenience class</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">boolean</span> autoAck = <span class="predefined-constant">false</span>;
channel.basicConsume(
    queueName,
    autoAck,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">myConsumerTag</span><span class="delimiter">&quot;</span></span>,
    <span class="keyword">new</span> DefaultConsumer(channel) {
      <span class="annotation">@Override</span>
      <span class="directive">public</span> <span class="type">void</span> handleDelivery(
          <span class="predefined-type">String</span> consumerTag, Envelope envelope,
          AMQP.BasicProperties properties, <span class="type">byte</span><span class="type">[]</span> body)
          <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="predefined-type">String</span> routingKey = envelope.getRoutingKey();
        <span class="predefined-type">String</span> contentType = properties.getContentType();
        <span class="type">long</span> deliveryTag = envelope.getDeliveryTag();
        <span class="comment">// (process the message components here ...)</span>
        channel.basicAck(deliveryTag, <span class="predefined-constant">false</span>);
      }
    });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, since we specified <code>autoAck = false</code>, it is necessary to acknowledge messages delivered to the <code>Consumer</code>, most conveniently done in the <code>handleDelivery</code> method, as illustrated.</p>
</div>
<div class="paragraph">
<p>More sophisticated <code>Consumer</code>s will need to override further methods.
In particular, <code>handleShutdownSignal</code> is called when channels and connections close, and <code>handleConsumeOk</code> is passed the consumer tag before any other callbacks to that <code>Consumer</code> are called.</p>
</div>
<div class="paragraph">
<p><code>Consumer</code>s can also implement the <code>handleCancelOk</code> and <code>handleCancel</code> methods to be notified of explicit and implicit cancellations, respectively.</p>
</div>
<div class="paragraph">
<p>You can explicitly cancel a particular <code>Consumer</code> with <code>Channel.basicCancel</code>, passing the consumer tag:</p>
</div>
<div class="listingblock">
<div class="title">Cancelling a consumer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">channel.basicCancel(consumerTag);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just like with publishers, it is important to consider concurrency hazard safety for consumers.</p>
</div>
<div class="paragraph">
<p>Callbacks to <code>Consumer</code>s are dispatched in a thread pool separate from the thread that instantiated its <code>Channel</code>.
This means that <code>Consumer</code>s can safely call blocking methods on the <code>Connection</code> or <code>Channel</code>, such as <code>Channel#queueDeclare</code> or <code>Channel#basicCancel</code>.</p>
</div>
<div class="paragraph">
<p>Each <code>Channel</code> will dispatch all deliveries to its <code>Consumer</code> handler methods on the thread pool in order they were sent by RabbitMQ.
Ordering of deliveries between channels is not guaranteed: those deliveries can be dispatched in parallel.</p>
</div>
<div class="paragraph">
<p>For the most common use case of one <code>Consumer</code> per <code>Channel</code>, this means <code>Consumer</code>s do not hold up other <code>Consumer</code>s.
With multiple <code>Consumer</code>s per <code>Channel</code> be aware that a long-running <code>Consumer</code> may hold up dispatch of callbacks to other <code>Consumer</code>s on that <code>Channel</code>.</p>
</div>
<div class="paragraph">
<p>Please refer to the <a href="#concurrency">Concurrency Considerations</a> (Thread Safety) section for other topics related to concurrency and concurrency hazard safety.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting"><a class="anchor" href="#getting"></a>Retrieving Individual Messages ("Pull API")</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is also possible to retrieve individual messages on demand ("pull API" a.k.a. polling).
This approach to consumption is highly inefficient as it is effectively polling and applications repeatedly have to ask for results even if the vast majority of the requests yield no results.
Therefore using this approach <strong>is highly discouraged</strong>.</p>
</div>
<div class="paragraph">
<p>To "pull" a message, use the <code>Channel.basicGet</code> method.
The returned value is an instance of <code>GetResponse</code>, from which the header information (properties) and message body can be extracted:</p>
</div>
<div class="listingblock">
<div class="title">Pulling a message with <code>basicGet</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">boolean</span> autoAck = <span class="predefined-constant">false</span>;
GetResponse response = channel.basicGet(queueName, autoAck);
<span class="keyword">if</span> (response == <span class="predefined-constant">null</span>) {
  <span class="comment">// No message retrieved.</span>
} <span class="keyword">else</span> {
  AMQP.BasicProperties props = response.getProps();
  <span class="type">byte</span><span class="type">[]</span> body = response.getBody();
  <span class="type">long</span> deliveryTag = response.getEnvelope().getDeliveryTag();
  <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since this example uses <a href="https://rabbitmq.com/confirms.html">manual acknowledgements</a> (the <code>autoAck = false</code> above), you must also call <code>Channel.basicAck</code> to acknowledge that you have successfully received the message:</p>
</div>
<div class="listingblock">
<div class="title">Acknowledging the message</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">channel.basicAck(response.getEnvelope().getDeliveryTag(), <span class="predefined-constant">false</span>);  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Acknowledge receipt of the message</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="returning"><a class="anchor" href="#returning"></a>Handling unroutable messages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If a message is published with the "mandatory" flags set, but cannot be routed, the broker will return it to the sending client (via an <code>AMQP.Basic.Return</code> command).</p>
</div>
<div class="paragraph">
<p>To be notified of such returns, clients can implement the <code>ReturnListener</code> interface and call <code>Channel.addReturnListener</code>.
If the client has not configured a return listener for a particular channel, then the associated returned messages will be silently dropped.</p>
</div>
<div class="listingblock">
<div class="title">Registering a <code>ReturnListener</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">channel.addReturnListener((replyCode, replyText, exchange,
                           routingKey, properties, body) -&gt; {
  <span class="comment">// handle unroutable message</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>A return listener will be called, for example, if the client publishes a message with the "mandatory" flag set to an exchange of "direct" type which is not bound to a queue.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shutdown"><a class="anchor" href="#shutdown"></a>Shutdown Protocol</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="shutdown-overview"><a class="anchor" href="#shutdown-overview"></a>Overview of the Client Shutdown Process</h3>
<div class="paragraph">
<p>The AMQP 0-9-1 connection and channel share the same general approach to managing network failure, internal failure, and explicit local shutdown.</p>
</div>
<div class="paragraph">
<p>The AMQP 0-9-1 connection and channel have the following lifecycle states:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>open</code>: the object is ready to use</p>
</li>
<li>
<p><code>closing</code>: the object has been explicitly notified to shut down locally, has issued a shutdown request to any supporting lower-layer objects, and is waiting for their shutdown procedures to complete</p>
</li>
<li>
<p><code>closed</code>: the object has received all shutdown-complete notification(s) from any lower-layer objects, and as a consequence has shut itself down</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Those objects always end up in the closed state, regardless of the reason that caused the closure, like an application request, an internal client library failure, a remote network request or network failure.</p>
</div>
<div class="paragraph">
<p>The connection and channel objects possess the following shutdown-related methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>addShutdownListener(ShutdownListener listener)</code> and <code>removeShutdownListener(ShutdownListener listener)</code>, to manage any listeners, which will be fired when the object transitions to`closed` state.
Note that, adding a <code>ShutdownListener</code> to an object that is already closed will fire the listener immediately</p>
</li>
<li>
<p><code>getCloseReason()</code>, to allow the investigation of what was the reason of the object&#8217;s shutdown</p>
</li>
<li>
<p><code>isOpen()</code>, useful for testing whether the object is in an open state</p>
</li>
<li>
<p><code>close(int closeCode, String closeMessage)</code>, to explicitly notify the object to shut down</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Simple usage of listeners would look like:</p>
</div>
<div class="listingblock">
<div class="title">Registering a <code>ShutdownListener</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">connection.addShutdownListener(cause -&gt; {
  <span class="comment">// action to run after shutdown, e.g. logging</span>
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="shutdown-cause"><a class="anchor" href="#shutdown-cause"></a>Information about the circumstances of a shutdown</h3>
<div class="paragraph">
<p>One can retrieve the <code>ShutdownSignalException</code>, which contains all the information available about the close reason, either by explicitly calling the <code>getCloseReason()`method or by using the `cause</code> parameter in the <code>service(ShutdownSignalException cause)</code> method of the <code>ShutdownListener</code> class.</p>
</div>
<div class="paragraph">
<p>The <code>ShutdownSignalException</code> class provides methods to analyze the reason of the shutdown.
By calling the <code>isHardError()</code> method we get information whether it was a connection or a channel error, and <code>getReason()</code> returns information about the cause, in the form an AMQP method - either <code>AMQP.Channel.Close</code> or <code>AMQP.Connection.Close</code> (or null if the cause was some exception in the library, such as a network communication failure, in which case that exception can be retrieved with <code>getCause()</code>).</p>
</div>
<div class="listingblock">
<div class="title">Getting shutdown information</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">connection.addShutdownListener(cause -&gt; {
  <span class="keyword">if</span> (cause.isHardError()) {
    <span class="predefined-type">Connection</span> conn = (<span class="predefined-type">Connection</span>) cause.getReference();
    <span class="keyword">if</span> (!cause.isInitiatedByApplication()) {
      <span class="predefined-type">Method</span> reason = cause.getReason();
      <span class="comment">// ...</span>
    }
  } <span class="keyword">else</span> {
    <span class="predefined-type">Channel</span> ch = (<span class="predefined-type">Channel</span>) cause.getReference();
    <span class="comment">// ...</span>
  }
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="shutdown-atomicity"><a class="anchor" href="#shutdown-atomicity"></a>Atomicity and use of the <code>isOpen()</code> method</h3>
<div class="paragraph">
<p>Use of the <code>isOpen()</code> method of channel and connection objects is not recommended for production code, because the value returned by the method is dependent on the existence of the shutdown cause.
The following code illustrates the possibility of race conditions:</p>
</div>
<div class="listingblock">
<div class="title">Avoid using <code>isOpen()</code> in production code</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// broken code, do not do this</span>
<span class="keyword">if</span> (channel.isOpen()) {
  <span class="comment">// The following code depends on the channel being in open state.</span>
  <span class="comment">// However, there is a possibility of the change in the channel state</span>
  <span class="comment">// between isOpen() and basicQos(1) call</span>
  <span class="comment">// ...</span>
  channel.basicQos(<span class="integer">1</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead, we should normally ignore such checking, and simply attempt the action desired.
If during the execution of the code the channel of the connection is closed, a <code>ShutdownSignalException</code> will be thrown indicating that the object is in an invalid state.
We should also catch for <code>IOException</code> caused either by <code>SocketException</code>, when broker closes the connection unexpectedly, or`ShutdownSignalException`, when broker initiated clean close.</p>
</div>
<div class="listingblock">
<div class="title">Catch exceptions to handle shutdown</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> {
  <span class="comment">// ...</span>
  channel.basicQos(<span class="integer">1</span>);
} <span class="keyword">catch</span> (ShutdownSignalException sse) {
  <span class="comment">// possibly check if channel was closed</span>
  <span class="comment">// by the time we started action and reasons for</span>
  <span class="comment">// closing it</span>
  <span class="comment">// ...</span>
} <span class="keyword">catch</span> (<span class="exception">IOException</span> ioe) {
  <span class="comment">// check why connection was closed</span>
  <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced-connection"><a class="anchor" href="#advanced-connection"></a>Advanced Connection Options</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="consumer-thread-pool"><a class="anchor" href="#consumer-thread-pool"></a>Consumer Operation Thread Pool</h3>
<div class="paragraph">
<p><code>Consumer</code> threads (see <a href="#consuming">Receiving</a>) are automatically allocated in a new <code>ExecutorService</code> thread pool by default.
If greater control is required supply an <code>ExecutorService</code> on the <code>newConnection()</code> method, so that this pool of threads is used instead.
Here is an example where a larger thread pool is supplied than is normally allocated:</p>
</div>
<div class="listingblock">
<div class="title">Using a custom thread pool for consumer operations</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">ExecutorService</span> es = <span class="predefined-type">Executors</span>.newFixedThreadPool(<span class="integer">20</span>);
<span class="predefined-type">Connection</span> conn = factory.newConnection(es);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>Executors</code> and <code>ExecutorService</code> classes are in the <code>java.util.concurrent</code> package.</p>
</div>
<div class="paragraph">
<p>When the connection is closed a default <code>ExecutorService</code> will be <code>shutdown()</code>, but a user-supplied <code>ExecutorService</code> (like <code>es</code> above) will <em>not</em> be <code>shutdown()</code>.
Clients that supply a custom <code>ExecutorService</code> must ensure it is shutdown eventually (by calling its <code>shutdown()</code> method), or else the pool&#8217;s threads may prevent JVM termination.</p>
</div>
<div class="paragraph">
<p>The same executor service may be shared between multiple connections, or serially re-used on re-connection but it cannot be used after it is <code>shutdown()</code>.</p>
</div>
<div class="paragraph">
<p>Use of this feature should only be considered if there is evidence that there is a severe bottleneck in the processing of <code>Consumer</code> callbacks.
If there are no <code>Consumer</code> callbacks executed, or very few, the default allocation is more than sufficient.
The overhead is initially minimal and the total thread resources allocated are bounded, even if a burst of consumer activity may occasionally occur.</p>
</div>
</div>
<div class="sect2">
<h3 id="service-discovery-with-address-resolver"><a class="anchor" href="#service-discovery-with-address-resolver"></a>Service discovery with the AddressResolver interface</h3>
<div class="paragraph">
<p>It is possible to use an implementation of <code>AddressResolver</code> to change the endpoint resolution algorithm used at connection time:</p>
</div>
<div class="listingblock">
<div class="title">Using an <code>AddressResolver</code> when opening a connection</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Connection</span> conn = factory.newConnection(addressResolver);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>AddressResolver</code> interface is like the following:</p>
</div>
<div class="listingblock">
<div class="title"><code>AddressResolver</code> interface</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AddressResolver</span> {

  <span class="predefined-type">List</span>&lt;Address&gt; getAddresses() <span class="directive">throws</span> <span class="exception">IOException</span>;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just like with <a href="#endpoints-list">a list of endpoints</a>, the first <code>Address</code> returned will be tried first, then the second if the client fails to connect to the first, and so on.</p>
</div>
<div class="paragraph">
<p>If an <code>ExecutorService</code> is provided as well (using the form <code>factory.newConnection(es, addressResolver)</code>) the thread pool is associated with the (first) successful connection.</p>
</div>
<div class="paragraph">
<p>The <code>AddressResolver</code> is the perfect place to implement custom service discovery logic, which is especially useful in a dynamic infrastructure. Combined with <a href="#recovery">automatic recovery</a>, the client can automatically connect to nodes that weren&#8217;t even up when it was first started.
Affinity and load balancing are other scenarios where a custom <code>AddressResolver</code> could be useful.</p>
</div>
<div class="paragraph">
<p>The Java client ships with the following implementations (see the javadoc for details):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DnsRecordIpAddressResolver</code>: given the name of a host, returns its IP addresses (resolution against
the platform DNS server).
This can be useful for simple DNS-based load balancing or failover.</p>
</li>
<li>
<p><code>DnsSrvRecordAddressResolver</code>: given the name of a service, returns hostname/port pairs.
The search is implemented as a DNS SRV request.
This can be useful when using a service registry like <a href="https://www.consul.io/">HashiCorp Consul</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="heartbeats-timeout"><a class="anchor" href="#heartbeats-timeout"></a>Heartbeat Timeout</h3>
<div class="paragraph">
<p>See the <a href="https://rabbitmq.com/heartbeats.html">Heartbeats guide</a> for more information about heartbeats and how to configure them in the Java client.</p>
</div>
</div>
<div class="sect2">
<h3 id="thread-factories"><a class="anchor" href="#thread-factories"></a>Custom Thread Factories</h3>
<div class="paragraph">
<p>Environments such as Google App Engine (GAE) can <a href="https://developers.google.com/appengine/docs/java/#Java_The_sandbox">restrict direct thread instantiation</a>.
To use RabbitMQ Java client in such environments, it&#8217;s necessary to configure a custom <code>ThreadFactory</code> that uses an appropriate method to instantiate threads, e.g. GAE&#8217;s <code>ThreadManager</code>.</p>
</div>
<div class="paragraph">
<p>Below is an example for Google App Engine:</p>
</div>
<div class="listingblock">
<div class="title">Setting a custom <code>ThreadFactory</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.google.appengine.api.ThreadManager</span>;

ConnectionFactory cf = <span class="keyword">new</span> ConnectionFactory();
cf.setThreadFactory(ThreadManager.backgroundThreadFactory());</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-nio"><a class="anchor" href="#java-nio"></a>Support for Java non-blocking IO</h3>
<div class="paragraph">
<p>Version 4.0 of the Java client brings support for Java non-blocking IO (a.k.a Java NIO).
NIO isn&#8217;t supposed to be faster than blocking IO, it simply allows to control resources (in this case, threads) more easily.</p>
</div>
<div class="paragraph">
<p>With the default blocking IO mode, each connection uses a thread to read from the network socket.
With the NIO mode, you can control the number of threads that read and write from/to the network socket.</p>
</div>
<div class="paragraph">
<p>Use the NIO mode if your Java process uses many connections (dozens or hundreds).
You should use fewer threads than with the default blocking mode.
With the appropriate number of threads set, you shouldn&#8217;t experience any decrease in performance, especially if the connections are not so busy.</p>
</div>
<div class="paragraph">
<p>NIO must be explicitly activated:</p>
</div>
<div class="listingblock">
<div class="title">Activating NIO</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();
connectionFactory.useNio();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The NIO mode can be configured through the <code>NioParams</code> class:</p>
</div>
<div class="listingblock">
<div class="title">Configuring NIO</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">connectionFactory.setNioParams(<span class="keyword">new</span> NioParams().setNbIoThreads(<span class="integer">4</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The NIO mode uses reasonable defaults, but you may need to change them according to your own workload.
Some of the settings are: the total number of IO threads used, the size of buffers, a service executor to use for the IO loops, parameters for the in-memory write queue (write requests are enqueued before being sent on the network).
Please read the Javadoc for details and defaults.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="recovery"><a class="anchor" href="#recovery"></a>Automatic Recovery From Network Failures</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="connection-recovery"><a class="anchor" href="#connection-recovery"></a>Connection Recovery</h3>
<div class="paragraph">
<p>Network connection between clients and RabbitMQ nodes can fail.
RabbitMQ Java client supports automatic recovery of connections and topology (queues, exchanges, bindings, and consumers).</p>
</div>
<div class="paragraph">
<p>The automatic recovery process for many applications follows the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reconnect</p>
</li>
<li>
<p>Restore connection listeners</p>
</li>
<li>
<p>Re-open channels</p>
</li>
<li>
<p>Restore channel listeners</p>
</li>
<li>
<p>Restore channel <code>basic.qos</code> setting, publisher confirms and transaction settings</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Topology recovery includes the following actions, performed for every channel:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Re-declare exchanges (except for predefined ones)</p>
</li>
<li>
<p>Re-declare queues</p>
</li>
<li>
<p>Recover all bindings</p>
</li>
<li>
<p>Recover all consumers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As of version 4.0.0 of the Java client, automatic recovery is enabled by default (and thus topology recovery as well).</p>
</div>
<div class="paragraph">
<p>Topology recovery relies on a per-connection cache of entities (queues, exchanges,
bindings, consumers).
When, say, a queue is declared on a connection, it will be added to the cache.
When it is deleted or is scheduled for deletion (e.g. because it is <a href="https://rabbitmq.com/queues.html">auto-deleted</a>) it will be removed.
This model has some limitations covered below.</p>
</div>
<div class="paragraph">
<p>To disable or enable automatic connection recovery, use the <code>factory.setAutomaticRecoveryEnabled(boolean)</code> method.
The following snippet shows how to explicitly enable automatic recovery (e.g. for Java client prior 4.0.0):</p>
</div>
<div class="listingblock">
<div class="title">Enabling recovery explicitly</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();
factory.setUsername(username);
factory.setPassword(password);
factory.setVirtualHost(virtualHost);
factory.setHost(host);
factory.setPort(port);
factory.setAutomaticRecoveryEnabled(<span class="predefined-constant">true</span>);  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="predefined-type">Connection</span> conn = factory.newConnection();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enable recovery</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If recovery fails due to an exception (e.g. RabbitMQ node is still not reachable), it will be retried after a fixed time interval (default is 5 seconds).
The interval can be configured (in milliseconds):</p>
</div>
<div class="listingblock">
<div class="title">Setting recovery interval</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();
factory.setNetworkRecoveryInterval(<span class="integer">10</span>_000);  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Attempt recovery every 10 seconds</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a list of addresses is provided, the first <a href="#endpoints-list">reachable endpoint</a> will be used for the initial connection.
In case of recovery, the list is shuffled and all addresses are tried, one after the next:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();
Address<span class="type">[]</span> addresses = {<span class="keyword">new</span> Address(<span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.1.4</span><span class="delimiter">&quot;</span></span>),
                       <span class="keyword">new</span> Address(<span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.1.5</span><span class="delimiter">&quot;</span></span>)};
factory.newConnection(addresses);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="recovery-triggers"><a class="anchor" href="#recovery-triggers"></a>When Will Connection Recovery Be Triggered?</h3>
<div class="paragraph">
<p>Automatic connection recovery, if enabled, will be triggered by the following events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An I/O exception is thrown in connection&#8217;s I/O loop</p>
</li>
<li>
<p>A socket read operation times out</p>
</li>
<li>
<p>Missed server <a href="https://rabbitmq.com/heartbeats.html">heartbeats</a> are detected</p>
</li>
<li>
<p>Any other unexpected exception is thrown in connection&#8217;s I/O loop</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>whichever happens first.</p>
</div>
<div class="paragraph">
<p>If initial client connection to a RabbitMQ node fails, automatic connection recovery won&#8217;t kick in.
Applications developers are responsible for retrying such connections, logging failed attempts, implementing a limit to the number of retries and so on.
Here&#8217;s a very basic example:</p>
</div>
<div class="listingblock">
<div class="title">Retrying initial connection</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();
<span class="comment">// configure various connection settings</span>
<span class="keyword">try</span> {
  <span class="predefined-type">Connection</span> conn = factory.newConnection();
} <span class="keyword">catch</span> (java.net.ConnectException e) {
  <span class="predefined-type">Thread</span>.sleep(<span class="integer">5000</span>);
  <span class="comment">// apply retry logic</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a connection is closed by the application via the <code>Connection.Close</code> method, connection recovery will not be initiated.</p>
</div>
<div class="paragraph">
<p>Channel-level exceptions will not trigger any kind of recovery as they usually indicate a semantic issue in the application (e.g. an attempt to consume from a non-existent queue).</p>
</div>
</div>
<div class="sect2">
<h3 id="recovery-listeners"><a class="anchor" href="#recovery-listeners"></a>Recovery Listeners</h3>
<div class="paragraph">
<p>It is possible to register one or more recovery listeners on recoverable connections and channels.
When connection recovery is enabled, connections returned by <code>ConnectionFactory#newConnection</code> and <code>Connection#createChannel</code> implement <code>com.rabbitmq.client.Recoverable</code>, providing two methods with
fairly descriptive names:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>addRecoveryListener</code></p>
</li>
<li>
<p><code>removeRecoveryListener</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that you currently need to cast connections and channels to <code>Recoverable</code> in order to use those methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="publishers"><a class="anchor" href="#publishers"></a>Effects on Publishing</h3>
<div class="paragraph">
<p>Messages that are published using <code>Channel.basicPublish</code> when connection is down will be lost.
The client does not enqueue them for delivery after connection has recovered.
To ensure that published messages reach RabbitMQ applications need to use <a href="https://rabbitmq.com/confirms.html">Publisher Confirms</a> and account for connection failures.</p>
</div>
</div>
<div class="sect2">
<h3 id="topology-recovery"><a class="anchor" href="#topology-recovery"></a>Topology Recovery</h3>
<div class="paragraph">
<p>Topology recovery involves recovery of exchanges, queues, bindings and consumers.
It is enabled by default when automatic recovery is enabled.
Topology recovery is enabled by default in modern versions of the client.</p>
</div>
<div class="paragraph">
<p>Topology recovery can be disabled explicitly if needed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();
factory.setAutomaticRecoveryEnabled(<span class="predefined-constant">true</span>);  <i class="conum" data-value="1"></i><b>(1)</b>
factory.setTopologyRecoveryEnabled(<span class="predefined-constant">false</span>);  <i class="conum" data-value="2"></i><b>(2)</b>
<span class="predefined-type">Connection</span> conn = factory.newConnection();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enable automatic recovery (e.g. Java client prior 4.0.0)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Disable topology recovery</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="automatic-recovery-limitations"><a class="anchor" href="#automatic-recovery-limitations"></a>Failure Detection and Recovery Limitations</h3>
<div class="paragraph">
<p>Automatic connection recovery has a number of limitations and intentional design decisions that applications developers need to be aware of.</p>
</div>
<div class="paragraph">
<p>Topology recovery relies on a per-connection cache of entities (queues, exchanges, bindings, consumers).
When, say, a queue is declared on a connection, it will be added to the cache.
When it is deleted or is scheduled for deletion (e.g. because it is <a href="https://rabbitmq.com/queues.html">auto-deleted</a>) it will be removed.
This makes it possible to declare and delete entities on different channels without having unexpected results.
It also means that consumer tags (a channel-specific identifier) must be unique across all channels on connections that use automatic connection recovery.</p>
</div>
<div class="paragraph">
<p>When a connection is down or lost, it <a href="https://rabbitmq.com/heartbeats.html">takes time to detect</a>.
Therefore there is a window of time in which both the library and the application are unaware of effective connection failure.
Any messages published during this time frame are serialised and written to the TCP socket as usual.
Their delivery to the broker can only be guaranteed via <a href="https://rabbitmq.com/confirms.html">publisher confirms</a>: publishing in AMQP 0-9-1 is entirely asynchronous by design.</p>
</div>
<div class="paragraph">
<p>When a socket or I/O operation error is detected by a connection with automatic recovery enabled, recovery begins after a configurable delay, 5 seconds by default.
This design assumes that even though a lot of network failures are transient and generally short-lived, they do not go away in an instant.
Having a delay also avoids an inherent race condition between server-side resource cleanup (such as <a href="https://rabbitmq.com/queues.html">exclusive or auto-delete queue</a> deletion) and operations performed on a newly opened connection on the same resources.</p>
</div>
<div class="paragraph">
<p>Connection recovery attempts by default will continue at identical time intervals until a new connection is successfully opened.
Recovery delay can be made dynamic by providing a <code>RecoveryDelayHandler</code> implementation instance to <code>ConnectionFactory#setRecoveryDelayHandler</code>.
Implementations that use dynamically computed delay intervals should avoid values that are too low (such as values that are lower than 2 seconds).</p>
</div>
<div class="paragraph">
<p>When a connection is in the recovering state, any publishing attempt on its channels will be rejected with an exception.
The client currently does not perform any internal buffering of such outgoing messages.
It is an application developer&#8217;s responsibility to keep track of such messages and republish them when recovery succeeds.
<a href="https://rabbitmq.com/confirms.html">Publisher confirms</a> is a protocol extension that should be used by publishers that cannot afford message loss.</p>
</div>
<div class="paragraph">
<p>Connection recovery will not kick in when a channel is closed due to a channel-level exception.
Such exceptions often indicate application-level issues.
The library cannot make an informed decision about when that&#8217;s the case.</p>
</div>
<div class="paragraph">
<p>Closed channels won&#8217;t be recovered even after connection recovery kicks in.
This includes both explicitly closed channels and the channel-level exception case above.</p>
</div>
</div>
<div class="sect2">
<h3 id="recovery-and-acknowledgements"><a class="anchor" href="#recovery-and-acknowledgements"></a>Manual Acknowledgements and Automatic Recovery</h3>
<div class="paragraph">
<p>When manual acknowledgements are used, it is possible that network connection to RabbitMQ node fails between message delivery and acknowledgement.
After connection recovery, RabbitMQ will reset delivery tags on all channels.</p>
</div>
<div class="paragraph">
<p>This means that <em>basic.ack</em>, <em>basic.nack</em>, and _basic.reject_with old delivery tags will cause a channel exception.
To avoid this, RabbitMQ Java client keeps track of and updates delivery tags to make them monotonically growing between recoveries.</p>
</div>
<div class="paragraph">
<p><code>Channel.basicAck</code>, <code>Channel.basicNack</code>, and <code>Channel.basicReject</code> then translate adjusted delivery tags into those used by RabbitMQ.</p>
</div>
<div class="paragraph">
<p>Acknowledgements with stale delivery tags will not be sent.
Applications that use manual acknowledgements and automatic recovery must be capable of handling redeliveries.</p>
</div>
</div>
<div class="sect2">
<h3 id="recovery-channel-lifecycle"><a class="anchor" href="#recovery-channel-lifecycle"></a>Channels Lifecycle and Topology Recovery</h3>
<div class="paragraph">
<p>Automatic connection recovery is meant to be as transparent as possible for the application developer, that&#8217;s why <code>Channel</code> instances remain the same even if several connections fail and recover behind the scenes.
Technically, when automatic recovery is on, <code>Channel</code> instances act as proxies or decorators: they delegate the AMQP business to an actual AMQP channel implementation and implement some recovery machinery around it.
That is why you shouldn&#8217;t close a channel after it has created some resources (queues, exchanges, bindings) or topology recovery for those resources will fail later, as the channel has been closed.
Instead, leave creating channels open for the life of the application.</p>
</div>
</div>
<div class="sect2">
<h3 id="cache-pitfalls"><a class="anchor" href="#cache-pitfalls"></a>Caveats and Limitations</h3>
<div class="paragraph">
<p>To make topology recovery possible, RabbitMQ Java client maintains a cache of declared queues, exchanges, and bindings.
The cache is per-connection.
Certain RabbitMQ features make it impossible for clients to observe some topology changes, e.g. when a queue is deleted due to TTL.
RabbitMQ Java client tries to invalidate cache entries in the most common cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a queue is deleted.</p>
</li>
<li>
<p>When an exchange is deleted.</p>
</li>
<li>
<p>When a binding is deleted.</p>
</li>
<li>
<p>When a consumer is cancelled on an auto-deleted queue.</p>
</li>
<li>
<p>When a queue or exchange is unbound from an auto-deleted exchange.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, the client cannot track these topology changes beyond a single connection.
Applications that rely on auto-delete queues or exchanges, as well as queue TTL (note: not message TTL!), and use <a href="#connection-recovery">automatic connection recovery</a>, should explicitly delete entities known to be unused or deleted, to purge client-side topology cache.
This is facilitated by <code>Channel#queueDelete</code>, <code>Channel#exchangeDelete</code>, <code>Channel#queueUnbind</code>, and <code>Channel#exchangeUnbind</code> being idempotent in RabbitMQ 3.3.x (deleting what&#8217;s not there does not result in an exception).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="unhandled-exceptions"><a class="anchor" href="#unhandled-exceptions"></a>Unhandled Exceptions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unhandled exceptions related to connection, channel, recovery, and consumer lifecycle are delegated to the exception handler.
Exception handler is any object that implements the <code>ExceptionHandler</code> interface.
By default, an instance of <code>DefaultExceptionHandler</code> is used.
It prints exception details to the standard output.</p>
</div>
<div class="paragraph">
<p>It is possible to override the handler using <code>ConnectionFactory#setExceptionHandler</code>.
It will be used for all connections created by the factory:</p>
</div>
<div class="listingblock">
<div class="title">Setting a customer exception handler</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();
factory.setExceptionHandler(customHandler);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exception handlers should be used for exception logging.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metrics"><a class="anchor" href="#metrics"></a>Metrics and Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The client collects runtime metrics (e.g. number of published messages) for active connections.
Metric collection is an optional feature that should be set up at the <code>ConnectionFactory</code> level, using the <code>setMetricsCollector(metricsCollector)</code> method.
This method expects a <code>MetricsCollector</code> instance, which is called in several places of the client code.</p>
</div>
<div class="paragraph">
<p>The client supports <a href="https://micrometer.io">Micrometer</a> and <a href="https://metrics.dropwizard.io">Dropwizard Metrics</a>.</p>
</div>
<div class="paragraph">
<p>Here are the collected metrics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of open connections</p>
</li>
<li>
<p>Number of open channels</p>
</li>
<li>
<p>Number of published messages</p>
</li>
<li>
<p>Number of confirmed messages</p>
</li>
<li>
<p>Number of negatively acknowledged (nack-ed) outbound messages</p>
</li>
<li>
<p>Number of unroutable outbound messages that got returned</p>
</li>
<li>
<p>Number of failures of outbound messages</p>
</li>
<li>
<p>Number of consumed messages</p>
</li>
<li>
<p>Number of acknowledged messages</p>
</li>
<li>
<p>Number of rejected messages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both Micrometer and Dropwizard Metrics provide counts, but also mean rate, last five minute rate, etc, for messages-related metrics.
They also support common tools for monitoring and reporting (JMX, Graphite, Ganglia, Datadog, etc).
See the dedicated sections below for more details.</p>
</div>
<div class="paragraph">
<p>Developers should keep a few things in mind when enabling metric collection.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Don&#8217;t forget to add the appropriate dependencies (in Maven, Gradle, or even as JAR files) to JVM
classpath when using Micrometer or Dropwizard Metrics.
Those are optional dependencies and will not be pulled automatically with the Java client.
You may also need to add other dependencies depending on the reporting backend(s) used.</p>
</li>
<li>
<p>Metrics collection is extensible.
Implementing a custom <code>MetricsCollector</code> for specific needs is encouraged.</p>
</li>
<li>
<p>The <code>MetricsCollector</code> is set at the <code>ConnectionFactory</code> level but can be shared across different instances.</p>
</li>
<li>
<p>Metrics collection doesn&#8217;t support transactions.
E.g. if an acknowledgment is sent in a transaction and the transaction is then rolled back, the acknowledgment is counted in the client metrics (but not by the broker obviously).
Note the acknowledgment is actually sent to the broker and then cancelled by the transaction rollback, so the client metrics are correct in terms of acknowledgments sent.
As a summary, don&#8217;t use client metrics for critical business logic, they are not guaranteed to be perfectly accurate.
They are meant to be used to simplify reasoning about a running system and make operations more efficient.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="metrics-micrometer"><a class="anchor" href="#metrics-micrometer"></a>Micrometer support</h3>
<div class="paragraph">
<p>For Micrometer you must set the <code>MeterRegistry</code> for one or several of the <a href="http://micrometer.io/docs">supported reporting backends</a> (Netflix Atlas, Prometheus, Datadog, Influx, JMX, etc).
Here is an example with Prometheus:</p>
</div>
<div class="listingblock">
<div class="title">Setting Micrometer with Prometheus</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();
MeterRegistry registry = <span class="keyword">new</span> PrometheusMeterRegistry(  <i class="conum" data-value="1"></i><b>(1)</b>
    PrometheusConfig.DEFAULT
);
MetricsCollector metricsCollector = <span class="keyword">new</span> MicrometerMetricsCollector(  <i class="conum" data-value="2"></i><b>(2)</b>
    registry
);
factory.setMetricsCollector(metricsCollector);  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create Micrometer&#8217;s <code>MeterRegistry</code> for Prometheus</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create <code>MetricsCollector</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set <code>MetricsCollector</code> on <code>ConnectionFactory</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note an application needs also to expose <a href="https://docs.micrometer.io/micrometer/reference/implementations/prometheus.html#_configuring">an HTTP endpoint to Prometheus' scraper</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="metrics-dropwizard-metrics"><a class="anchor" href="#metrics-dropwizard-metrics"></a>Dropwizard Metrics support</h3>
<div class="paragraph">
<p>Enable metrics collection with <a href="https://metrics.dropwizard.io">Dropwizard</a> like so:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Dropwizard Metrics</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();
StandardMetricsCollector metricsCollector =
    <span class="keyword">new</span> StandardMetricsCollector();
connectionFactory.setMetricsCollector(metricsCollector);
<span class="comment">// ...</span>
metricsCollector.getPublishedMessages();  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get Metrics' <code>Meter</code> object</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Dropwizard Metrics supports <a href="http://metrics.dropwizard.io/4.2.0/getting-started.html">several reporting backends</a>: console, JMX, HTTP, Graphite, etc.</p>
</div>
<div class="paragraph">
<p>You would typically pass in an instance of <code>MetricsRegistry</code> to the <code>StandardMetricsCollector</code>.
Here is an example with JMX:</p>
</div>
<div class="listingblock">
<div class="title">Enabling JMX support for Dropwizard Metrics</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MetricRegistry registry = <span class="keyword">new</span> MetricRegistry();
MetricsCollector metricsCollector = <span class="keyword">new</span> StandardMetricsCollector(
    registry
);

ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();
connectionFactory.setMetricsCollector(metricsCollector);

JmxReporter reporter = JmxReporter.forRegistry(registry)
    .inDomain(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.rabbitmq.client.jmx</span><span class="delimiter">&quot;</span></span>)
    .build();
reporter.start();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gae-pitfalls"><a class="anchor" href="#gae-pitfalls"></a>RabbitMQ Java Client on Google App Engine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using RabbitMQ Java client on Google App Engine (GAE) requires using a <a href="#thread-factories">a custom thread factory</a> that instantiates thread using GAE&#8217;s <code>ThreadManager</code> (see above).
In addition, it is necessary to set a low heartbeat interval (4-5 seconds) to avoid running into the low <code>InputStream</code> read timeouts on GAE:</p>
</div>
<div class="listingblock">
<div class="title">Setting a 5-second heartbeat for GAE</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();
factory.setRequestedHeartbeat(<span class="integer">5</span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rpc"><a class="anchor" href="#rpc"></a>The RPC (Request/Reply) Pattern: an Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As a programming convenience, the Java client API offers a class <code>RpcClient</code> which uses a temporary reply queue to provide simple <a href="https://rabbitmq.com/tutorials/tutorial-six-java.html">RPC-style communication</a> facilities via AMQP 0-9-1.</p>
</div>
<div class="paragraph">
<p>The class doesn&#8217;t impose any particular format on the RPC arguments and return values.
It simply provides a mechanism for sending a message to a given exchange with a particular routing key, and waiting for a response on a reply queue.</p>
</div>
<div class="listingblock">
<div class="title">Declaring an RPC client</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RpcClient rpc = <span class="keyword">new</span> RpcClient(<span class="keyword">new</span> RpcClientParams()
    .channel(channel)
    .exchange(exchangeName)
    .routingKey(routingKey));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation details of how this class uses AMQP 0-9-1 are as follows: request messages are sent with the <code>basic.correlation_id</code> field set to a value unique for this <code>RpcClient</code> instance,
and with <code>basic.reply_to</code> set to the name of the reply queue.</p>
</div>
<div class="paragraph">
<p>Once you have created an instance of this class, you can use it to send RPC requests by using any of the following methods:</p>
</div>
<div class="listingblock">
<div class="title"><code>RpcClient</code> methods</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">byte</span><span class="type">[]</span> primitiveCall(<span class="type">byte</span><span class="type">[]</span> message);
<span class="predefined-type">String</span> stringCall(<span class="predefined-type">String</span> message);
<span class="predefined-type">Map</span> mapCall(<span class="predefined-type">Map</span> message);
<span class="predefined-type">Map</span> mapCall(<span class="predefined-type">Object</span><span class="type">[]</span> keyValuePairs);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>primitiveCall</code> method transfers raw byte arrays as the request and response bodies.
The method <code>stringCall</code> is a thin convenience wrapper around <code>primitiveCall</code>, treating the message bodies as <code>String</code> instances in the default character encoding.</p>
</div>
<div class="paragraph">
<p>The <code>mapCall</code> variants are a little more sophisticated: they encode a <code>java.util.Map</code> containing ordinary Java values into an AMQP 0-9-1 binary table representation, and decode the response in the same way.
Note that there are some restrictions on what value types can be used here - see the Javadoc for details.</p>
</div>
<div class="paragraph">
<p>All the marshalling/unmarshalling convenience methods use <code>primitiveCall</code> as a transport mechanism, and just provide a wrapping layer on top of it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tls"><a class="anchor" href="#tls"></a>TLS Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s possible to encrypt the communication between the client and the broker <a href="https://rabbitmq.com/ssl.html">using TLS</a>.
Client and server authentication (a.k.a. peer verification) is also supported.
Here is the simplest, most naive way to use encryption with the Java client:</p>
</div>
<div class="listingblock">
<div class="title">TLS simplest configuration, do not use in production</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();
factory.setHost(<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>);
factory.setPort(<span class="integer">5671</span>);
<span class="comment">// Only suitable for development.</span>
<span class="comment">// This code will not perform peer certificate chain verification</span>
<span class="comment">// and is prone to man-in-the-middle attacks.</span>
<span class="comment">// See the main TLS guide to learn about peer verification</span>
<span class="comment">// and how to enable it.</span>
factory.useSslProtocol();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the client doesn&#8217;t enforce any server authentication (<a href="https://rabbitmq.com/ssl.html#peer-verification">peer certificate chain verification</a>) in the above sample as the default, "trust all certificates" <code>TrustManager</code> is used.
This is convenient for local development but <strong>prone to man-in-the-middle attacks</strong> and therefore <a href="https://rabbitmq.com/production-checklist.html">not recommended for production</a>.</p>
</div>
<div class="paragraph">
<p>To learn more about TLS support in RabbitMQ, see the <a href="https://rabbitmq.com/ssl.html">TLS guide</a>.
If you only want to configure the Java client (especially the peer verification and trust manager parts), read <a href="https://rabbitmq.com/ssl.html#java-client">the appropriate section</a> of the TLS guide.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="oauth2-support"><a class="anchor" href="#oauth2-support"></a>OAuth 2 Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The client can authenticate against an OAuth 2 server like <a href="https://github.com/cloudfoundry/uaa">UAA</a>.
The <a href="https://github.com/rabbitmq/rabbitmq-server/tree/main/deps/rabbitmq_auth_backend_oauth2">OAuth 2 plugin</a> must be enabled on the server side and configured to use the same OAuth 2 server as the client.</p>
</div>
<div class="sect2">
<h3 id="oauth2-getting-token"><a class="anchor" href="#oauth2-getting-token"></a>Getting the OAuth 2 Token</h3>
<div class="paragraph">
<p>The Java client provides the <code>OAuth2ClientCredentialsGrantCredentialsProvider</code> class to get a JWT token using the <a href="https://tools.ietf.org/html/rfc6749#section-4.4">OAuth 2 Client Credentials flow</a>.
The client will send the JWT token in the password field when opening a connection.
The broker will then verify the JWT token signature, validity, and permissions before authorising the connection and granting access to the requested virtual host.</p>
</div>
<div class="paragraph">
<p>Prefer the use of <code>OAuth2ClientCredentialsGrantCredentialsProviderBuilder</code> to create an <code>OAuth2ClientCredentialsGrantCredentialsProvider</code> instance and then set it up on the <code>ConnectionFactory</code>.
The following snippet shows how to configure and create an instance of the OAuth 2 credentials provider for the <a href="https://github.com/rabbitmq/rabbitmq-server/tree/main/deps/rabbitmq_auth_backend_oauth2#examples">example setup of the OAuth 2 plugin</a>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring OAuth2 <code>CredentialsProvider</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// from com.rabbitmq.client.impl package</span>
CredentialsProvider credentialsProvider =
    <span class="keyword">new</span> OAuth2ClientCredentialsGrantCredentialsProviderBuilder()
        .tokenEndpointUri(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/uaa/oauth/token/</span><span class="delimiter">&quot;</span></span>)
        .clientId(<span class="string"><span class="delimiter">&quot;</span><span class="content">rabbit_client</span><span class="delimiter">&quot;</span></span>).clientSecret(<span class="string"><span class="delimiter">&quot;</span><span class="content">rabbit_secret</span><span class="delimiter">&quot;</span></span>)
        .grantType(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>)
        .parameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">rabbit_super</span><span class="delimiter">&quot;</span></span>)
        .parameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">rabbit_super</span><span class="delimiter">&quot;</span></span>)
        .build();

connectionFactory.setCredentialsProvider(credentialsProvider);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In production, make sure to use HTTPS for the token endpoint URI and configure the <code>SSLContext</code> if necessary for the HTTPS requests (to verify and trust the identity of the OAuth 2 server).
The following snippet does so by using the <code>tls().sslContext(SSLContext)</code> method from <code>OAuth2ClientCredentialsGrantCredentialsProviderBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring TLS for OAuth2 <code>CredentialsProvider</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">SSLContext</span> sslContext = <span class="predefined-type">SSLContext</span>.getInstance(<span class="string"><span class="delimiter">&quot;</span><span class="content">TLSv1.3</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>

CredentialsProvider credentialsProvider =
    <span class="keyword">new</span> OAuth2ClientCredentialsGrantCredentialsProviderBuilder()
        .tokenEndpointUri(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://localhost:8443/uaa/oauth/token/</span><span class="delimiter">&quot;</span></span>)
        .clientId(<span class="string"><span class="delimiter">&quot;</span><span class="content">rabbit_client</span><span class="delimiter">&quot;</span></span>)
        .clientSecret(<span class="string"><span class="delimiter">&quot;</span><span class="content">rabbit_secret</span><span class="delimiter">&quot;</span></span>)
        .grantType(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>)
        .parameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">rabbit_super</span><span class="delimiter">&quot;</span></span>)
        .parameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">rabbit_super</span><span class="delimiter">&quot;</span></span>)
        .tls() <i class="conum" data-value="2"></i><b>(2)</b>
            .sslContext(sslContext) <i class="conum" data-value="3"></i><b>(3)</b>
            .builder() <i class="conum" data-value="4"></i><b>(4)</b>
        .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create then initialise <code>SSLContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure TLS</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set <code>SSLContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Go back to main configuration</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please consult the <a href="https://rabbitmq.github.io/rabbitmq-java-client/api/current/com/rabbitmq/client/impl/OAuth2ClientCredentialsGrantCredentialsProvider.html">Javadoc</a> to see all the available options.</p>
</div>
</div>
<div class="sect2">
<h3 id="oauth2-refreshing-token"><a class="anchor" href="#oauth2-refreshing-token"></a>Refreshing the Token</h3>
<div class="paragraph">
<p>Tokens expire and the broker will refuse operations on connections with expired tokens.
To avoid this, it is possible to call <code>CredentialsProvider#refresh()</code> before expiration and send the new token to the server.
This is cumbersome from an application point of view, so the Java client provides help with the <code>DefaultCredentialsRefreshService</code>.
This utility tracks used tokens, refreshes them before they expire, and send the new tokens for the connections it is responsible for.</p>
</div>
<div class="paragraph">
<p>The following snippet shows how to create a <code>DefaultCredentialsRefreshService</code> instance and set it up on the <code>ConnectionFactory</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring the token refresh service</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// from com.rabbitmq.client.impl</span>
CredentialsRefreshService refreshService =
    <span class="keyword">new</span> DefaultCredentialsRefreshServiceBuilder().build();
connectionFactory.setCredentialsRefreshService(refreshService);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>DefaultCredentialsRefreshService</code> schedules a refresh after 80% of the token validity time, e.g. if the token expires in 60 minutes, it will be refreshed after 48 minutes.
This is the default behaviour, please consult the <a href="https://rabbitmq.github.io/rabbitmq-java-client/api/current/com/rabbitmq/client/impl/DefaultCredentialsRefreshService.html">Javadoc</a> for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="micrometer-observation"><a class="anchor" href="#micrometer-observation"></a>Appendix A: Micrometer Observation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to use <a href="https://docs.micrometer.io/micrometer/reference/observation.html">Micrometer Observation</a> to instrument publishing and consuming in the Java client.
Micrometer Observation provides <a href="https://spring.io/blog/2022/10/12/observability-with-spring-boot-3">metrics, tracing, and log correlation with one single API</a>.</p>
</div>
<div class="paragraph">
<p>The Java client provides an <code>ObservationCollector</code> abstraction and an implementation for Micrometer Observation.
The following snippet shows how to create and set up the Micrometer <code>ObservationCollector</code> implementation with an existing <code>ObservationRegistry</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Micrometer Observation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// from com.rabbitmq.client.observation and</span>
<span class="comment">// com.rabbitmq.client.observation.micrometer packages</span>
ObservationCollector observationCollector =
    <span class="keyword">new</span> MicrometerObservationCollectorBuilder() <i class="conum" data-value="1"></i><b>(1)</b>
          .registry(observationRegistry)
          .build();
factory.setObservationCollector(observationCollector); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure Micrometer <code>ObservationCollector</code> with builder</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set Micrometer <code>ObservationRegistry</code> on <code>ConnectionFactory</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next sections document the conventions, spans, and metrics made available by the instrumentation.
They are automatically generated from the source code with the <a href="https://github.com/micrometer-metrics/micrometer-docs-generator">Micrometer documentation generator</a>.</p>
</div>
<div class="sect2">
<h3 id="observability-conventions"><a class="anchor" href="#observability-conventions"></a>Observability - Conventions</h3>
<div class="paragraph">
<p>Below you can find a list of all <code>GlobalObservationConvention</code> and <code>ObservationConvention</code> declared by this project.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. ObservationConvention implementations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ObservationConvention Class Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applicable ObservationContext Class Name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.rabbitmq.client.observation.micrometer.DefaultDeliverObservationConvention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DeliverContext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.rabbitmq.client.observation.micrometer.DefaultProcessObservationConvention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DeliverContext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.rabbitmq.client.observation.micrometer.DefaultReceiveObservationConvention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DeliverContext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.rabbitmq.client.observation.micrometer.DeliverObservationConvention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DeliverContext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.rabbitmq.client.observation.micrometer.DefaultPublishObservationConvention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PublishContext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.rabbitmq.client.observation.micrometer.PublishObservationConvention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PublishContext</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="observability-spans"><a class="anchor" href="#observability-spans"></a>Observability - Spans</h3>
<div class="paragraph">
<p>Below you can find a list of all spans declared by this project.</p>
</div>
<div class="sect3">
<h4 id="observability-spans-process-observation"><a class="anchor" href="#observability-spans-process-observation"></a>Process Observation Span</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Observation for processing a message.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Span name</strong> <code>rabbitmq.process</code> (defined by convention class <code>com.rabbitmq.client.observation.micrometer.DefaultProcessObservationConvention</code>).</p>
</div>
<div class="paragraph">
<p>Fully qualified name of the enclosing class <code>com.rabbitmq.client.observation.micrometer.RabbitMqObservationDocumentation</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Tag Keys</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>messaging.operation</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying the kind of messaging operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>messaging.system</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying the messaging system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>net.protocol.name</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying the protocol (AMQP).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>net.protocol.version</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying the protocol version (0.9.1).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="observability-spans-publish-observation"><a class="anchor" href="#observability-spans-publish-observation"></a>Publish Observation Span</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Observation for publishing a message.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Span name</strong> Unable to resolve the name - please check the convention class <code>com.rabbitmq.client.observation.micrometer.DefaultPublishObservationConvention</code> for more details.</p>
</div>
<div class="paragraph">
<p>Fully qualified name of the enclosing class <code>com.rabbitmq.client.observation.micrometer.RabbitMqObservationDocumentation</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Tag Keys</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>messaging.operation</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying the kind of messaging operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>messaging.system</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying the messaging system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>net.protocol.name</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying the protocol (AMQP).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>net.protocol.version</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying the protocol version (0.9.1).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="observability-spans-receive-observation"><a class="anchor" href="#observability-spans-receive-observation"></a>Receive Observation Span</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Observation for polling for a message with basic.get.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Span name</strong> <code>rabbitmq.receive</code> (defined by convention class <code>com.rabbitmq.client.observation.micrometer.DefaultReceiveObservationConvention</code>).</p>
</div>
<div class="paragraph">
<p>Fully qualified name of the enclosing class <code>com.rabbitmq.client.observation.micrometer.RabbitMqObservationDocumentation</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Tag Keys</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>messaging.operation</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying the kind of messaging operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>messaging.system</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying the messaging system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>net.protocol.name</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying the protocol (AMQP).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>net.protocol.version</code> <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying the protocol version (0.9.1).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="observability-metrics"><a class="anchor" href="#observability-metrics"></a>Observability - Metrics</h3>
<div class="paragraph">
<p>Below you can find a list of all metrics declared by this project.</p>
</div>
<div class="sect3">
<h4 id="observability-metrics-process-observation"><a class="anchor" href="#observability-metrics-process-observation"></a>Process Observation</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Observation for processing a message.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>rabbitmq.process</code> (defined by convention class <code>com.rabbitmq.client.observation.micrometer.DefaultProcessObservationConvention</code>). <strong>Type</strong> <code>timer</code>.</p>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>rabbitmq.process.active</code> (defined by convention class <code>com.rabbitmq.client.observation.micrometer.DefaultProcessObservationConvention</code>). <strong>Type</strong> <code>long task timer</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
KeyValues that are added after starting the Observation might be missing from the *.active metrics.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Micrometer internally uses <code>nanoseconds</code> for the baseunit. However, each backend determines the actual baseunit. (i.e. Prometheus uses seconds)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Fully qualified name of the enclosing class <code>com.rabbitmq.client.observation.micrometer.RabbitMqObservationDocumentation</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Low cardinality Keys</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>messaging.operation</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A string identifying the kind of messaging operation.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>messaging.system</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A string identifying the messaging system.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>net.protocol.name</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A string identifying the protocol (AMQP).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>net.protocol.version</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A string identifying the protocol version (0.9.1).</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="observability-metrics-publish-observation"><a class="anchor" href="#observability-metrics-publish-observation"></a>Publish Observation</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Observation for publishing a message.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> Unable to resolve the name - please check the convention class <code>com.rabbitmq.client.observation.micrometer.DefaultPublishObservationConvention</code> for more details. <strong>Type</strong> <code>timer</code>.</p>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>.active</code> (defined by convention class <code>com.rabbitmq.client.observation.micrometer.DefaultPublishObservationConvention</code>). <strong>Type</strong> <code>long task timer</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
KeyValues that are added after starting the Observation might be missing from the *.active metrics.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Micrometer internally uses <code>nanoseconds</code> for the baseunit. However, each backend determines the actual baseunit. (i.e. Prometheus uses seconds)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Fully qualified name of the enclosing class <code>com.rabbitmq.client.observation.micrometer.RabbitMqObservationDocumentation</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Low cardinality Keys</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>messaging.operation</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A string identifying the kind of messaging operation.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>messaging.system</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A string identifying the messaging system.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>net.protocol.name</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A string identifying the protocol (AMQP).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>net.protocol.version</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A string identifying the protocol version (0.9.1).</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="observability-metrics-receive-observation"><a class="anchor" href="#observability-metrics-receive-observation"></a>Receive Observation</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Observation for polling for a message with basic.get.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>rabbitmq.receive</code> (defined by convention class <code>com.rabbitmq.client.observation.micrometer.DefaultReceiveObservationConvention</code>). <strong>Type</strong> <code>timer</code>.</p>
</div>
<div class="paragraph">
<p><strong>Metric name</strong> <code>rabbitmq.receive.active</code> (defined by convention class <code>com.rabbitmq.client.observation.micrometer.DefaultReceiveObservationConvention</code>). <strong>Type</strong> <code>long task timer</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
KeyValues that are added after starting the Observation might be missing from the *.active metrics.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Micrometer internally uses <code>nanoseconds</code> for the baseunit. However, each backend determines the actual baseunit. (i.e. Prometheus uses seconds)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Fully qualified name of the enclosing class <code>com.rabbitmq.client.observation.micrometer.RabbitMqObservationDocumentation</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Low cardinality Keys</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>messaging.operation</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A string identifying the kind of messaging operation.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>messaging.system</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A string identifying the messaging system.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>net.protocol.name</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A string identifying the protocol (AMQP).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>net.protocol.version</code> <em>(required)</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A string identifying the protocol version (0.9.1).</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 6.0.0-SNAPSHOT<br>
Last updated 2024-02-06 11:13:23 +0100
</div>
</div>
</body>
</html>